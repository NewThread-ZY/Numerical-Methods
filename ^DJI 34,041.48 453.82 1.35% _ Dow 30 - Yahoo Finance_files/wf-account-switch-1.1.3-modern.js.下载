!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wafer-account-switch",[],t):"object"==typeof exports?exports["wafer-account-switch"]=t():(e.wafer=e.wafer||{},e.wafer.wafers=e.wafer.wafers||{},e.wafer.wafers["wafer-account-switch"]=t())}("undefined"!=typeof self?self:this,function(){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="https://s.yimg.com/aaq/wf/",t(t.s="./src/entry.js")}({"./src/entry.js":function(e,t,r){"use strict";function o(e){return Array.isArray(e)?e:Array.from(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=/(profile_|39361574426_98028a_)/,f=function(e,t){var r=e.alias,o=void 0===r?"":r,n=e.email,i=void 0===n?"":n,s=e.firstName,a=void 0===s?"":s,c=e.fn,u=void 0===c?"":c,f=e.guid,d=void 0===f?"":f,p=e.lastName,h=void 0===p?"":p,v=e.ln,y=void 0===v?"":v,m=e.nickName,w=void 0===m?"":m,b=e.yid,g=e.profileImage,_=u||a||w||"",A=y||h,C=document.createElement("div");if(!g||l.test(g)){var O=(_[0]||"").toUpperCase(),T=O.charCodeAt(0);g=T>=65&&T<=90?"https://s.yimg.com/rz/uh/alphatars/"+O+".png":"https://s.yimg.com/ag/images/default_user_profile_pic_192sq.jpg"}return C.innerHTML=t.replace(/\${ALIAS}/g,o).replace(/\${EMAIL}/g,i).replace(/\${FIRSTNAME}/g,_).replace(/\${GUID}/g,d).replace(/\${LASTNAME}/g,A).replace(/\${PROFILE_IMAGE}/g,g).replace(/\${YID}/g,b),C.children[0]},d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},p=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),h=function e(t,r,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,o)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(o)},v=window.wafer,y=v.base,m=v.constants,w=v.utils,b=v.WaferBaseClass,g=m.ATTR_PREFIX,_=w.findAncestor,A=w.getTemplateContent,C=w.loadScriptAsync,O=2,T=["handleFetchClick"],j=[],E="wafer-account-switch-no-data",k=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.errorClass,s=r.selector,a=r.successClass;n(this,t);var c=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{errorClass:o,selector:s,successClass:a},{STATE_ATTRS:j})),u=e.getAttribute(g+"boundary"),l=encodeURIComponent(c._util.crumb||e.getAttribute(g+"crumb")),f=parseInt(e.getAttribute(g+"count"),10),p=isNaN(f)||f<=0?O:f,h=e.getAttribute(g+"replace"),v=e.getAttribute(g+"target"),y=e.getAttribute(g+"identity"),m=e.getAttribute(g+"timeout"),w=document.getElementById(g+"account-switch-template-id"),b=w&&A(w),C=e.getAttribute(g+"trigger")||"viewport",E=e.getAttribute(g+"retry-count"),k=e.getAttribute(g+"set-focus");if(k=null===k||void 0===k?0:Number(k),!(E=null===E||void 0===E?null:Number(E)))switch(C){case"onLoad":case"viewport":E=2}var L=v&&(u&&_(e,u)||document.body).querySelector(v)||e;return L&&k&&L.setAttribute("tabIndex","-1"),c._util=d({},c._util,{count:p,crumb:l,templateText:b,timeout:null===m||void 0===m?6e3:Number(m),elem:e,errorClass:o,replace:null===h||void 0===h?0:Number(h),retryCount:E,selector:s,setFocus:k,shouldAlwaysTrigger:!1,targetElem:L,trigger:C,type:"default",successClass:a,useIdentity:null===y||void 0===y?0:Number(y)}),c._state={retries:0,status:status},T.forEach(function(e){c[e]=c[e].bind(c)}),"click"===C&&(c._util.hasClick=!0),c}return s(t,e),p(t,[{key:"fetch",value:function(){var e=this,r=this._util,n=r.elem,i=r.shouldAlwaysTrigger,s=r.successClass;if(!i&&n.classList.contains(s))return Promise.resolve(!0);var a=this._util,c=a.count,u=a.crumb,l=a.errorClass,d=a.replace,p=a.selector,h=a.setFocus,v=a.targetElem,m=a.timeout,w=a.useIdentity;return 0!==this._state.status?(this._state.status=0,new Promise(function(e,t){var r=!1,o=setTimeout(function(){window.processDeviceUsers=function(){},r=!0,t(new Error("Request timed out"))},m);window.processDeviceUsers=function(t){clearTimeout(o),r||e(t)},C({src:(w?"https://jsapi.login.yahoo.com/w/device_users?.crumb=":"https://login.yahoo.com/w/device_users?.crumb=")+u},function(e,r){e&&t(new Error("Error loading"));var o=r.parentNode;o&&o.removeChild(r),window.processDeviceUsers=function(){}})}).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.users,a=void 0===r?[]:r,u=e._util.targetElem;if(i||n.classList.remove(p.replace(".","")),n.classList.remove(l),n.classList.add(s),u.classList.remove("wafer-account-switch-inprogress"),!Array.isArray(a))return n.classList.add(E),!0;var v=e._util.templateText,m=o(a),w=m.slice(1);if(!Array.isArray(w)||!w.length)return n.classList.add(E),!0;n.classList.remove(E);var b=document.createElement("div"),g=void 0;if(w.slice(0,c).forEach(function(e){b.appendChild(f(e,v))}),d){var _=u.parentNode;u.insertAdjacentHTML("beforebegin",b.innerHTML),_.removeChild(u),g=_}else u.innerHTML=b.innerHTML,g=u;return y.sync(g),h&&setTimeout(function(){return u.focus()},5),e._state.retries=0,y.emitWaferEvent("accountswitch:success",{elem:n,meta:{}}),!0}).catch(function(r){var o=e._util.retryCount;return y.emitError({name:t.constructor.name,elem:n,meta:{},stack:r.stack}),n.classList.add(l,E),v.classList.remove("wafer-account-switch-inprogress"),e._state.status=2,++e._state.retries===o&&(y.destroy(v),!0)})):Promise.resolve(!1)}},{key:"stateDidUpdate",value:function(){}},{key:"destroy",value:function(){var e=this._util.timeoutInstance;e&&(clearTimeout(e),this._util.timeoutInstance=null),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"handleFetchClick",value:function(e){this._util.hasClick&&this.fetch()}},{key:"config",get:function(){return{trigger:this._util.trigger}}}]),t}(b);k.events={click:[["has-account-switch-fetch-click","handleFetchClick"]]};var L=k,I=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),P=window.wafer.utils,x=P.elementInView,N=P.throttle,M=window.wafer.base,S=window.wafer.controllers.WaferBaseController,R=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.errorClass,o=void 0===r?"wafer-account-switch-error":r,n=e.root,i=void 0===n?document:n,s=e.selector,u=e.successClass,l=void 0===u?"wafer-account-switch-complete":u,f=e.validateDelay,d=void 0===f?25:f;a(this,t);var p=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{root:i,selector:s,props:{errorClass:o,selector:s,successClass:l},WaferClass:L}));return p._validateWithThrottle=N(function(){p.validate()},d,p),p.sync(),p}return u(t,e),I(t,[{key:"handleScroll",value:function(){this._validateWithThrottle()}},{key:"handleResize",value:function(){this._validateWithThrottle()}},{key:"didSync",value:function(){var e=this._state,t=e.elementInstances,r=e.mounted;0===t.size||r||(this._state.mounted=!0)}},{key:"willValidate",value:function(e){var t=this._state.elementInstances;e.forEach(function(e){var r=t.get(e),o=r.instance;switch(o.config.trigger){case"viewport":x(e,{offsetX:0,offsetY:0},M.viewport)&&o.fetch().then(function(e){e&&o.destroy()});break;case"onLoad":o.fetch().then(function(e){e&&o.destroy()});break;case"click":e.classList.add("has-account-switch-fetch-click")}})}}]),t}(S),F=R;t.default=new F({selector:".wafer-account-switch"})}})});